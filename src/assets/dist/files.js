webpackJsonp([1],[,,function(e,t,n){var i=n(0);t.shake=function(e,t){t="undefined"==typeof t?10:t;var n=2*t;return i(e).width(i(e).width()).animate({marginLeft:"+="+t},50).animate({marginLeft:"-="+n},50).animate({marginLeft:"+="+n},50).animate({marginLeft:"-="+t},50).queue(function(){i(e).css("width","").css("margin-left","").finish()})},t.onLongPress=function(e,t){var n=!1,i=function(e){n=!0},r=function(e){n=!1};e.addEventListener("touchstart",i),e.addEventListener("touchend",r),e.addEventListener("touchcancel",r),e.addEventListener("touchmove",r),e.addEventListener("contextmenu",function(e){if(n)return t(e)})},t.setProgress=function(e,t,n){var i=e.children[0],r=e.children[1];t=Math.floor(t),t>=100?e.className="progress success":e.className="progress active",i.style.width=t+"%",i.innerText=t+"%","undefined"!=typeof n&&(r.innerText=n)},t.handleLogin=function(e){var n=i("body").data("path").replace(/\/$/,"");i("#login").find("input").prop("disabled",!1),i(".login-frame").show(),i("#login").submit(function(){var r=i(this).find('[name="request_token"]').val();return i(this).find("input").prop("disabled",!0),i.ajax({url:n,method:"post",data:{request_token:r,username:i("#username").val(),password:i("#password").val(),remember:i("#remember_remember").is(":checked")?{remember:"remember"}:null},success:function(){i(".login-frame").css({overflow:"hidden",whiteSpace:"no-wrap"}).animate({width:0},function(){i(this).hide().css({overflow:"",whiteSpace:"",width:""}),i("#login").off("submit"),i("#password").val(""),e()})},error:function(e){i("#login").find("input").prop("disabled",!1),t.shake(i(".login-frame")),i("#username").select(),i("#password").val("")},global:!1}),!1})},t.handleError=function(e,n,r,a){return 401===n.status?(i("#login-overlay").show(),i("#password").focus(),void t.handleLogin(function(){i("#login-overlay").hide(),i.ajax(r)})):("undefined"!=typeof n.responseJSON?alert(n.responseJSON.message):alert(n.responseText),t.shake(i("main > .frame")),void console.log(e,n,r,a))}},function(e,t,n){function i(e,t){for(var n=e.toLowerCase().split(/-|\+/),i={ctrlKey:"",altKey:"",shiftKey:""},e=n[n.length-1],r=0;r<n.length-1;r++)switch(n[r]){case"c":i.ctrlKey="c-";break;case"a":i.altKey="a-";break;case"s":i.shiftKey="s-"}e=i.ctrlKey+i.altKey+i.shiftKey+e,p[e]=t}function r(e,t,n){f[e]=t,u('[data-action="'+e+'"]').click(function(e){return e.preventDefault(),e.stopPropagation(),t(),!1}),"undefined"!=typeof n&&n.forEach(function(t){d.hasOwnProperty(t)||(d[t]=[]),d[t].push(e)})}function a(e){f[e]()}function o(e){d.hasOwnProperty(e)&&d[e].forEach(function(e){c(e)})}function l(e){d.hasOwnProperty(e)&&d[e].forEach(function(e){s(e)})}function c(e){"string"==typeof e?u('[data-action="'+e+'"]').attr("disabled",!1):e.forEach(c)}function s(e){"string"==typeof e?u('[data-action="'+e+'"]').attr("disabled",!0):e.forEach(s)}var u=n(0);t.define=r,t.enable=c,t.disable=s,t.enableGroup=o,t.disableGroup=l,t.activate=a,t.bind=i;var f={},d={},p={};u(window).keydown(function(e){if(!e.defaultPrevented){var t="";return e.ctrlKey&&(t+="c-"),e.altKey&&(t+="a-"),e.shiftKey&&(t+="s-"),e.metaKey&&(t+="m-"),t+=e.key.toLowerCase(),p.hasOwnProperty(t)?(a(p[t]),!1):void 0}})},function(e,t){function n(e){var e=e.replace(/\/[^\/]+$/,"");return""===e?"/":e}function i(e){return e.replace(/^.*\//,"")}function r(e,t){e=e.trim(),e.startsWith("/")||(e=t+"/"+e);for(var n=e.split("/"),i=[],r=0;r<n.length;r++)".."===n[r]?i.length>=1&&i.pop():""!==n[r]&&"."!==n[r]&&i.push(n[r]);return"/"+i.join("/")}t.dirName=n,t.fileName=i,t.convert=r},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(i){"object"==typeof window&&(n=window)}e.exports=n},,function(e,t,n){(function(e,i){function r(e,t){this._id=e,this._clearFn=t}var a=n(45).nextTick,o=Function.prototype.apply,l=Array.prototype.slice,c={},s=0;t.setTimeout=function(){return new r(o.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(o.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var n=s++,i=!(arguments.length<2)&&l.call(arguments,1);return c[n]=!0,a(function(){c[n]&&(i?e.apply(null,i):e.call(null),t.clearImmediate(n))}),n},t.clearImmediate="function"==typeof i?i:function(e){delete c[e]}}).call(t,n(7).setImmediate,n(7).clearImmediate)},,,,,,,,,function(e,t,n){"use strict";(function(t){function i(e,t){function n(e){return ue.containers.indexOf(e)!==-1||se.isContainer(e)}function i(e){var t=e?"remove":"add";r(E,t,"mousedown",k),r(E,t,"mouseup",I)}function l(e){var t=e?"remove":"add";r(E,t,"mousemove",S)}function v(e){var t=e?"remove":"add";b[t](E,"selectstart",T),b[t](E,"click",T)}function g(){i(!0),I({})}function T(e){le&&e.preventDefault()}function k(e){te=e.clientX,ne=e.clientY;var t=1!==a(e)||e.metaKey||e.ctrlKey;if(!t){var n=e.target,i=P(n);i&&(le=i,l(),"mousedown"===e.type&&(h(n)?n.focus():e.preventDefault()))}}function S(e){if(le){if(0===a(e))return void I({});if(void 0===e.clientX||e.clientX!==te||void 0===e.clientY||e.clientY!==ne){if(se.ignoreInputTextSelection){var t=y("clientX",e),n=y("clientY",e),i=x.elementFromPoint(t,n);if(h(i))return}var r=le;l(!0),v(),G(),K(r);var c=o(Q);Z=y("pageX",e)-c.left,ee=y("pageY",e)-c.top,C.add(ae||Q,"gu-transit"),B(),F(e)}}}function P(e){if(!(ue.dragging&&V||n(e))){for(var t=e;p(e)&&n(p(e))===!1;){if(se.invalid(e,t))return;if(e=p(e),!e)return}var i=p(e);if(i&&!se.invalid(e,t)){var r=se.moves(e,i,t,m(e));if(r)return{item:e,source:i}}}}function O(e){return!!P(e)}function L(e){var t=P(e);t&&K(t)}function K(e){$(e.item,e.source)&&(ae=e.item.cloneNode(!0),ue.emit("cloned",ae,e.item,"copy")),W=e.source,Q=e.item,ie=re=m(e.item),ue.dragging=!0,ue.emit("drag",Q,W)}function _(){return!1}function G(){if(ue.dragging){var e=ae||Q;D(e,p(e))}}function N(){le=!1,l(!0),v(!0)}function I(e){if(N(),ue.dragging){var t=ae||Q,n=y("clientX",e),i=y("clientY",e),r=c(V,n,i),a=M(r,n,i);a&&(ae&&se.copySortSource||!ae||a!==W)?D(t,a):se.removeOnSpill?j():q()}}function D(e,t){var n=p(e);ae&&se.copySortSource&&t===W&&n.removeChild(Q),A(t)?ue.emit("cancel",e,W,W):ue.emit("drop",e,t,W,re),X()}function j(){if(ue.dragging){var e=ae||Q,t=p(e);t&&t.removeChild(e),ue.emit(ae?"cancel":"remove",e,t,W),X()}}function q(e){if(ue.dragging){var t=arguments.length>0?e:se.revertOnSpill,n=ae||Q,i=p(n),r=A(i);r===!1&&t&&(ae?i&&i.removeChild(ae):W.insertBefore(n,ie)),r||t?ue.emit("cancel",n,W,W):ue.emit("drop",n,i,W,re),X()}}function X(){var e=ae||Q;N(),H(),e&&C.rm(e,"gu-transit"),oe&&clearTimeout(oe),ue.dragging=!1,ce&&ue.emit("out",e,ce,W),ue.emit("dragend",e),W=Q=ae=ie=re=oe=ce=null}function A(e,t){var n;return n=void 0!==t?t:V?re:m(ae||Q),e===W&&n===ie}function M(e,t,i){function r(){var r=n(a);if(r===!1)return!1;var o=J(a,e),l=U(a,o,t,i),c=A(a,l);return!!c||se.accepts(Q,a,W,l)}for(var a=e;a&&!r();)a=p(a);return a}function F(e){function t(e){ue.emit(e,s,ce,W)}function n(){d&&t("over")}function i(){ce&&t("out")}if(V){e.preventDefault();var r=y("clientX",e),a=y("clientY",e),o=r-Z,l=a-ee;V.style.left=o+"px",V.style.top=l+"px";var s=ae||Q,u=c(V,r,a),f=M(u,r,a),d=null!==f&&f!==ce;(d||null===f)&&(i(),ce=f,n());var h=p(s);if(f===W&&ae&&!se.copySortSource)return void(h&&h.removeChild(s));var v,g=J(f,u);if(null!==g)v=U(f,g,r,a);else{if(se.revertOnSpill!==!0||ae)return void(ae&&h&&h.removeChild(s));v=ie,f=W}(null===v&&d||v!==s&&v!==m(s))&&(re=v,f.insertBefore(s,v),ue.emit("shadow",s,f,W))}}function R(e){C.rm(e,"gu-hide")}function Y(e){ue.dragging&&C.add(e,"gu-hide")}function B(){if(!V){var e=Q.getBoundingClientRect();V=Q.cloneNode(!0),V.style.width=f(e)+"px",V.style.height=d(e)+"px",C.rm(V,"gu-transit"),C.add(V,"gu-mirror"),se.mirrorContainer.appendChild(V),r(E,"add","mousemove",F),C.add(se.mirrorContainer,"gu-unselectable"),ue.emit("cloned",V,Q,"mirror")}}function H(){V&&(C.rm(se.mirrorContainer,"gu-unselectable"),r(E,"remove","mousemove",F),p(V).removeChild(V),V=null)}function J(e,t){for(var n=t;n!==e&&p(n)!==e;)n=p(n);return n===E?null:n}function U(e,t,n,i){function r(){var t,r,a,o=e.children.length;for(t=0;t<o;t++){if(r=e.children[t],a=r.getBoundingClientRect(),l&&a.left+a.width/2>n)return r;if(!l&&a.top+a.height/2>i)return r}return null}function a(){var e=t.getBoundingClientRect();return o(l?n>e.left+f(e)/2:i>e.top+d(e)/2)}function o(e){return e?m(t):t}var l="horizontal"===se.direction,c=t!==e?a():r();return c}function $(e,t){return"boolean"==typeof se.copy?se.copy:se.copy(e,t)}var z=arguments.length;1===z&&Array.isArray(e)===!1&&(t=e,e=[]);var V,W,Q,Z,ee,te,ne,ie,re,ae,oe,le,ce=null,se=t||{};void 0===se.moves&&(se.moves=u),void 0===se.accepts&&(se.accepts=u),void 0===se.invalid&&(se.invalid=_),void 0===se.containers&&(se.containers=e||[]),void 0===se.isContainer&&(se.isContainer=s),void 0===se.copy&&(se.copy=!1),void 0===se.copySortSource&&(se.copySortSource=!1),void 0===se.revertOnSpill&&(se.revertOnSpill=!1),void 0===se.removeOnSpill&&(se.removeOnSpill=!1),void 0===se.direction&&(se.direction="vertical"),void 0===se.ignoreInputTextSelection&&(se.ignoreInputTextSelection=!0),void 0===se.mirrorContainer&&(se.mirrorContainer=x.body);var ue=w({containers:se.containers,start:L,end:G,cancel:q,remove:j,destroy:g,canMove:O,dragging:!1});return se.removeOnSpill===!0&&ue.on("over",R).on("out",Y),i(),ue}function r(e,n,i,r){var a={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},o={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},l={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};t.navigator.pointerEnabled?b[n](e,o[i],r):t.navigator.msPointerEnabled?b[n](e,l[i],r):(b[n](e,a[i],r),b[n](e,i,r))}function a(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var t=e.button;return void 0!==t?1&t?1:2&t?3:4&t?2:0:void 0}function o(e){var t=e.getBoundingClientRect();return{left:t.left+l("scrollLeft","pageXOffset"),top:t.top+l("scrollTop","pageYOffset")}}function l(e,n){return"undefined"!=typeof t[n]?t[n]:E.clientHeight?E[e]:x.body[e]}function c(e,t,n){var i,r=e||{},a=r.className;return r.className+=" gu-hide",i=x.elementFromPoint(t,n),r.className=a,i}function s(){return!1}function u(){return!0}function f(e){return e.width||e.right-e.left}function d(e){return e.height||e.bottom-e.top}function p(e){return e.parentNode===x?null:e.parentNode}function h(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||v(e)}function v(e){return!!e&&("false"!==e.contentEditable&&("true"===e.contentEditable||v(p(e))))}function m(e){function t(){var t=e;do t=t.nextSibling;while(t&&1!==t.nodeType);return t}return e.nextElementSibling||t()}function g(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}function y(e,t){var n=g(t),i={pageX:"clientX",pageY:"clientY"};return e in i&&!(e in n)&&i[e]in n&&(e=i[e]),n[e]}var w=n(36),b=n(37),C=n(40),x=document,E=x.documentElement;e.exports=i}).call(t,n(5))},,function(e,t){},,,,,,,function(e,t){e.exports=function(e,t){return Array.prototype.slice.call(e,t)}},,,,,,,,,,function(e,t,n){"use strict";var i=n(47);e.exports=function(e,t,n){e&&i(function(){e.apply(n||null,t||[])})}},function(e,t,n){"use strict";var i=n(25),r=n(35);e.exports=function(e,t){var n=t||{},a={};return void 0===e&&(e={}),e.on=function(t,n){return a[t]?a[t].push(n):a[t]=[n],e},e.once=function(t,n){return n._once=!0,e.on(t,n),e},e.off=function(t,n){var i=arguments.length;if(1===i)delete a[t];else if(0===i)a={};else{var r=a[t];if(!r)return e;r.splice(r.indexOf(n),1)}return e},e.emit=function(){var t=i(arguments);return e.emitterSnapshot(t.shift()).apply(this,t)},e.emitterSnapshot=function(t){var o=(a[t]||[]).slice(0);return function(){var a=i(arguments),l=this||e;if("error"===t&&n["throws"]!==!1&&!o.length)throw 1===a.length?a[0]:a;return o.forEach(function(i){n.async?r(i,a,l):i.apply(l,a),i._once&&e.off(t,i)}),e}},e}},function(e,t,n){"use strict";(function(t){function i(e,t,n,i){return e.addEventListener(t,n,i)}function r(e,t,n){return e.attachEvent("on"+t,s(e,t,n))}function a(e,t,n,i){return e.removeEventListener(t,n,i)}function o(e,t,n){var i=u(e,t,n);if(i)return e.detachEvent("on"+t,i)}function l(e,t,n){function i(){var e;return h.createEvent?(e=h.createEvent("Event"),e.initEvent(t,!0,!0)):h.createEventObject&&(e=h.createEventObject()),e}function r(){return new d(t,{detail:n})}var a=p.indexOf(t)===-1?r():i();e.dispatchEvent?e.dispatchEvent(a):e.fireEvent("on"+t,a)}function c(e,n,i){return function(n){var r=n||t.event;r.target=r.target||r.srcElement,r.preventDefault=r.preventDefault||function(){r.returnValue=!1},r.stopPropagation=r.stopPropagation||function(){r.cancelBubble=!0},r.which=r.which||r.keyCode,i.call(e,r)}}function s(e,t,n){var i=u(e,t,n)||c(e,t,n);return g.push({wrapper:i,element:e,type:t,fn:n}),i}function u(e,t,n){var i=f(e,t,n);if(i){var r=g[i].wrapper;return g.splice(i,1),r}}function f(e,t,n){var i,r;for(i=0;i<g.length;i++)if(r=g[i],r.element===e&&r.type===t&&r.fn===n)return i}var d=n(39),p=n(38),h=t.document,v=i,m=a,g=[];t.addEventListener||(v=r,m=o),e.exports={add:v,remove:m,fabricate:l}}).call(t,n(5))},function(e,t,n){"use strict";(function(t){var n=[],i="",r=/^on/;for(i in t)r.test(i)&&n.push(i.slice(2));e.exports=n}).call(t,n(5))},function(e,t,n){(function(t){function n(){try{var e=new i("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(t){}return!1}var i=t.CustomEvent;e.exports=n()?i:"function"==typeof document.createEvent?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=Boolean(t.bubbles),n.cancelable=Boolean(t.cancelable),n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n}}).call(t,n(5))},function(e,t){"use strict";function n(e){var t=a[e];return t?t.lastIndex=0:a[e]=t=new RegExp(o+e+l,"g"),t}function i(e,t){var i=e.className;i.length?n(t).test(i)||(e.className+=" "+t):e.className=t}function r(e,t){e.className=e.className.replace(n(t)," ").trim()}var a={},o="(?:^|\\s)",l="(?:\\s|$)";e.exports={add:i,rm:r}},,,,,function(e,t){function n(e){if(c===setTimeout)return setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function i(e){if(s===clearTimeout)return clearTimeout(e);try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}function r(){p&&f&&(p=!1,f.length?d=f.concat(d):h=-1,d.length&&a())}function a(){if(!p){var e=n(r);p=!0;for(var t=d.length;t;){for(f=d,d=[];++h<t;)f&&f[h].run();h=-1,t=d.length}f=null,p=!1,i(e)}}function o(e,t){this.fun=e,this.array=t}function l(){}var c,s,u=e.exports={};!function(){try{c=setTimeout}catch(e){c=function(){throw new Error("setTimeout is not defined")}}try{s=clearTimeout}catch(e){s=function(){throw new Error("clearTimeout is not defined")}}}();var f,d=[],p=!1,h=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];d.push(new o(e,t)),1!==d.length||p||n(a)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=l,u.addListener=l,u.once=l,u.off=l,u.removeListener=l,u.removeAllListeners=l,u.emit=l,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},,function(e,t,n){(function(t){var n,i="function"==typeof t;n=i?function(e){t(e)}:function(e){setTimeout(e,0)},e.exports=n}).call(t,n(7).setImmediate)},,,,,function(e,t,n){function i(e){location.href=k+"/open"+e}function r(e){e[0].ondragenter=function(t){return t.stopPropagation(),t.preventDefault(),t.dropEffect="copy",e.addClass("accept"),!1},e[0].ondragleave=function(t){return t.stopPropagation(),t.preventDefault(),e.removeClass("accept"),!1},e[0].ondragover=function(e){return e.stopPropagation(),e.preventDefault(),e.dropEffect="copy",!1},e[0].ondrop=function(t){t.stopPropagation(),t.preventDefault();var n=event.dataTransfer.files,i=new FormData;i.append("request_token",P);for(var r=0;r<n.length;r++)i.append("file"+r,n[r]),l(e,{name:n[r].name,path:e.data("path")+"/"+n[r].name,type:"uploading"});var a=new XMLHttpRequest;return a.open("POST",k+"/api/upload?path="+e.data("path")),a.send(i),a.onreadystatechange=function(){if(3===this.readyState||4===this.readyState){var t=e.data("path");e.data("path",null),g(e,t)}},!1}}function a(e,t){N[t.path]={link:e,data:t},e.hasClass("file-directory")||e.dblclick(function(){if(!q)return i(C(this).data("path")),!1}),E.onLongPress(e[0],function(n){return n.preventDefault(),n.stopPropagation(),e.hasClass("active")?p(t.path):h(t.path),q=!0,!1}),e.click(function(n){if(n.ctrlKey||q)e.hasClass("active")?p(t.path):h(t.path);else if(n.shiftKey){var i=I[I.length-1],r=D;if(e.hasClass("active")||h(t.path),D!==r&&(i=I[0]),N.hasOwnProperty(i)){var a=N[i].link;if(a.parent().is(e.parent())){var o=!1;e.parent().children().each(function(){var t=C(this);(t.is(e)||t.is(a))&&(o=!o),o&&!t.hasClass("active")&&h(t.data("path"))})}}}else f(t.path);return!1})}function o(e){var t=C('<a class="file">');return t.text(e.name),_.filter(function(t){return t===e.path}).length>0&&t.addClass("active"),e.read||t.addClass("locked"),t.attr("data-path",e.path),t.attr("href",k+"/files"+e.path),t.addClass("file-"+e.type),a(t,e),t}function l(e,t){var n=o(t);return e.children(".files-list").append(n),n}function c(e,t){N.hasOwnProperty(t.path)||o(t);var n,r=C('<div class="file-info">');switch(t.type.toLowerCase()){case"jpeg":case"jpg":case"png":case"ico":n=C('<img class="file-thumbnail">'),n.attr("src",k+"/api/download?path="+encodeURIComponent(t.path));break;default:n=C('<span class="file">'),n.addClass("file-"+t.type),t.read||n.addClass("locked")}var a=C('<span class="file-name">');a.text(t.name);var l=C('<span class="file-modified">');l.text(new Date(1e3*t.modified).toString());var c=C('<span class="file-access">');if(c.text(t.modeString+" "+t.owner+":"+t.group+" ("+(t.read?"r":"-")+(t.write?"w":"-")+")"),r.append(n).append(a).append(l).append(c),t.read){var s=C("<button>Open in editor</button>");s.click(function(){i(t.path)}).appendTo(r)}e.children(".files-list").replaceWith(r)}function s(){_.length<=1||(_.pop(),K=_[_.length-1],q=!1,_.length>1?(I=[K],x.enableGroup("selection"),x.enableGroup("selection-single")):(I=[],x.disableGroup("selection"),x.disableGroup("selection-single")),D=_[_.length-1],m(),history.pushState({cwd:K},document.title,k+"/files"+K))}function u(){L.data("path",null),g(L,K)}function f(e){v(e),N.hasOwnProperty(e)&&N[e].link.addClass("active"),history.pushState({cwd:K},document.title,k+"/files"+K)}function d(){return 1===I.length&&I[0]===D?void s():(I.forEach(function(e){N[e].link.removeClass("active")}),I=[],q=!1,x.disableGroup("selection"),x.disableGroup("selection-single"),void f(D))}function p(e){var t=I.indexOf(e);if(t>=0)if(I.splice(t,1),console.log(I),N[e].link.removeClass("active"),0===I.length)q=!1,L.next().children(".file-info").empty(),f(D);else{1===I.length?x.enableGroup("selection-single"):x.disableGroup("selection-single");var n=L.next().children(".file-info");if(n.length>0){var i=n.children(".file-name");i.text(I.length+" files")}}}function h(e){var t=T.dirName(e);if(t!==D){if(I.length>1)return;D=t;for(var n=[],i=0;i<_.length;i++)if(_[i]===D&&i+1<_.length){n.push(_[i+1]);break}v(t),I=n,I.length>0&&N[I[0]].link.addClass("active")}else 1===I.length&&T.dirName(I[0])!==D&&(I=[]);x.enableGroup("selection"),I.push(e),x.disableGroup("dir"),1===I.length?x.enableGroup("selection-single"):x.disableGroup("selection-single"),console.log(I,D),N[e].link.addClass("active");var r=L.next().children(".file-info");if(r.length>0){r.empty();var a=C('<span class="file file-multiple">'),o=C('<span class="file-name">');o.text(I.length+" files"),r.append(a).append(o)}else if(L.next().length>0){L.next().empty();var r=C('<div class="file-info">');r.appendTo(L.next());var a=C('<span class="file file-multiple">'),o=C('<span class="file-name">');o.text(I.length+" files"),r.append(a).append(o)}}function v(e){var t=e.split("/"),e="";_=["/"];for(var n=0;n<t.length;n++)".."===t[n]?_.length>1&&(_.pop(),e=_[_.length-1]):""!==t[n]&&"."!==t[n]&&(e+="/"+t[n],_.push(e));K=_[_.length-1],q=!1,_.length>1?(I=[e],x.enableGroup("selection"),x.enableGroup("selection-single")):(I=[],x.disableGroup("selection"),x.disableGroup("selection-single")),D=_[_.length-1],m()}function m(){console.log("stack",_,"cwd",K,"stackOffset",j);var e=S.children(),t=e.length;if(j=Math.max(0,_.length-t),S.find("a").removeClass("active"),L.children(".filter").remove(),L=e.eq(Math.min(t,_.length)-1),_.length>=G)for(var n=0;n<t;n++){var i=e.eq(n);j+n<_.length?g(i,_[j+n]):g(i,null)}else for(var n=t-1;n>=0;n--){var i=e.eq(n);j+n<_.length?g(i,_[j+n]):g(i,null)}G=_.length,C(".header-path").text(K),document.title=K+" – Files"}function g(e,t){if(e.data("path")!==t||null===t){var n=e.children(".files-list");0===n.length&&(e.empty(),n=C('<div class="files-list">'),e.append(n)),n.empty(),e.data("path",null),e.removeClass("readonly"),e.next().data("path")===t?(e.data("path",t),e.next().children(".files-list").children().appendTo(n),e.next().hasClass("readonly")&&e.addClass("readonly")):e.prev().data("path")===t?(e.data("path",t),e.prev().children(".files-list").children().appendTo(n),e.prev().hasClass("readonly")&&e.addClass("readonly")):null!==t&&(e.addClass("loading"),C.ajax({url:k+"/api/list-files",data:{path:t},success:function(i){if(e.removeClass("loading"),n.empty(),e.removeClass("readonly"),e.data("path",t),i.write||e.addClass("readonly"),"directory"===i.type&&"undefined"!=typeof i.files){for(var r=0;r<i.files.length;r++){var a=i.files[r];l(e,a)}e.is(L)&&x.enableGroup("dir")}else c(e,i),e.is(L)&&x.disableGroup("dir");e.trigger("loaded")}}))}N.hasOwnProperty(t)&&(N[t].link.addClass("active"),e.is(L)&&("directory"===N[t].data.type?x.enableGroup("dir"):x.disableGroup("dir")))}function y(){var e=S.children().length,t=Math.max(1,Math.floor(S.width()/200));if(t>e)for(var n=t-e,i=0;i<n;i++){var a=C('<div class="files-panel">');a.append('<div class="files-list">'),a.appendTo(S),r(a)}else{if(!(t<e))return!1;for(var o=e-t,i=0;i<o;i++)S.children().last().remove()}return S.children().css("width",100/t+"%"),!0}function w(e){var t=!0;e===e.toLowerCase()&&(t=!1);var n=null;return L.find(".file").each(function(){var i=C(this).text();if(t||(i=i.toLowerCase()),i.slice(0,e.length)===e)return n=C(this),!1}),n}function b(){var e=L.children(".filter");if(L.find(".match").removeClass("match"),e.length>0)if(""===e.val())e.remove();else{var t=w(e.val());null!==t&&t.addClass("match")}}var C=n(0),x=n(3),E=n(2),T=n(4);n(16);n(18);var k=C("body").data("path").replace(/\/$/,""),S=C(".files-columns"),P=S.data("token"),O=C(".files-shelf > .files-grid"),L=S.children().first(),K=L.data("path");L.data("path",null);var _=[],G=0,N={},I=[],D="/",j=0;C(document).ajaxError(E.handleError);var q=!1,X=K;window.onpopstate=function(e){null!==e.state?v(e.state.cwd):X!==K&&v(X)},C(window).keydown(function(e){if(!e.defaultPrevented&&!(C("input:focus").length>0||e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)){var t=L.children(".filter");if(1===e.key.length)return 0===t.length?(C('<input type="text" class="filter">').val(e.key).appendTo(L).focus().keydown(function(e){if(!(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)){if("Escape"===e.key)return C(this).remove(),b(),!1;if("Enter"===e.key){var t=L.find(".match");return t.length>0&&(C(this).remove(),t.click()),!1}}}).keyup(b).blur(function(){C(this).remove(),b()}),b(),!1):void 0}}),x.define("back",function(){history.back()},["nav"]),x.define("foreward",function(){history.go(1)},["nav"]),x.define("up",function(){s()},["nav"]),x.define("home",function(){f("/")},["nav"]),x.define("new-folder",function(){var e=prompt("Enter the new name:");if(null!==e){if(""===e)return void alert("Invalid name");var t;t="/"===K?K+e:K+"/"+e,C.ajax({url:k+"/api/make-dir",method:"post",data:{request_token:P,path:t},success:function(e){l(L,e),f(t)}})}},["dir"]),x.define("new-file",function(){var e=prompt("Enter the new name:");if(null!==e){if(""===e)return void alert("Invalid name");var t;t="/"===K?K+e:K+"/"+e,C.ajax({url:k+"/api/make-file",method:"post",data:{request_token:P,path:t},success:function(e){l(L,e),f(t)}})}},["dir"]),x.define("upload",function(){var e=C('<input type="file" />').appendTo(C("body")),t=L;e.hide(),e.click(),e.change(function(){var n=e[0].files,i=new FormData;i.append("request_token",P);for(var r=0;r<n.length;r++)i.append("file"+r,n[r]),l(t,{name:n[r].name,path:t.data("path")+"/"+n[r].name,type:"uploading"});var a=new XMLHttpRequest;return a.open("POST",k+"/api/upload?path="+t.data("path")),a.send(i),a.onreadystatechange=function(){if(3===this.readyState||4===this.readyState){var n=t.data("path");t.data("path",null),g(t,n),e.remove()}},!1})},["dir"]),x.define("rename",function(){if(!(_.length<=1)){if(1!==I.length)return void alert("Cannot rename multiple files");var e=I[0],t=prompt("Enter the new name:",N[e].data.name);if(null!==t){""===t&&alert("Invalid name");var n=T.convert(t,T.dirName(e));C.ajax({url:k+"/api/move",method:"post",data:{request_token:P,path:e,destination:n},success:function(e){f(n),u()}})}}},["selection-single"]),x.define("trash",function(){var e,t={request_token:P};1===I.length?(e=confirm("Permanently delete file: "+I[0]),t.path=I[0]):(e=confirm("Permanently delete "+I.length+" files?"),t.paths=I),e&&C.ajax({url:k+"/api/delete",method:"post",data:t,success:function(e){d(),u()}})},["selection"]),x.define("cut",function(){if(1===I.length)N[I[0]].link.clone().removeClass("active").appendTo(O);else{var e=I,t=C('<a class="file file-multiple">');t.text(I.length+" files"),t.data("paths",e),t.appendTo(O)}d()},["selection"]),x.define("copy",function(){if(1===I.length)N[I[0]].link.clone().removeClass("active").addClass("duplicate").appendTo(O);else{var e=I,t=C('<a class="file file-multiple duplicate">');t.text(I.length+" files"),t.data("paths",e),t.appendTo(O)}d()},["selection"]),x.define("paste",function(){if(O.children().length>0){var e=O.children().last(),t=e.hasClass("duplicate"),n={request_token:P},i=[];if("undefined"!=typeof e.data("paths"))n.paths={},e.data("paths").forEach(function(e){n.paths[e]=T.convert(N[e].data.name,K),i.push(N[e])});else{n.path=e.data("path");var r=N[n.path];n.destination=T.convert(r.data.name,K),i.push(r)}C.ajax({url:k+(t?"/api/copy":"/api/move"),method:"post",data:n,success:function(n){e.remove(),t||i.forEach(function(e){e.link.remove()}),u()}})}},["dir"]),x.define("focus-prev",function(){var e=L.find(".file:focus");if(e.length>0){var t=e.prev();t.length>0&&t.focus()}else L.find(".file").last().focus()},["nav"]),x.define("focus-next",function(){var e=L.find(".file:focus");if(e.length>0){var t=e.next();t.length>0&&t.focus()}else L.find(".file").first().focus()},["nav"]),x.define("enter",function(){var e=L.find(".file:focus");e.length>0&&(f(e.data("path")),L.one("loaded",function(){C(this).find(".file").first().focus()}))},["nav"]),x.define("exit",function(){if(_.length>1){var e=K;s(),N[e].link.focus()}},["nav"]),x.bind("F2","rename"),x.bind("C-C","copy"),x.bind("C-X","cut"),x.bind("C-V","paste"),x.bind("Delete","trash"),x.bind("C-H","exit"),x.bind("C-K","focus-prev"),x.bind("C-J","focus-next"),x.bind("C-L","enter"),x.bind("ArrowLeft","exit"),x.bind("ArrowUp","focus-prev"),x.bind("ArrowDown","focus-next"),x.bind("ArrowRight","enter"),x.disableGroup("selection"),x.disableGroup("selection-single"),x.disableGroup("dir"),S.empty(),y(),v(K),S.click(function(e){e.defaultPrevented||1===I.length&&I[0]===D||d()}),C(window).resize(function(){y()&&m()})}],[52]);
//# sourceMappingURL=files.js.map
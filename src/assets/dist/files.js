webpackJsonp([1],[,function(e,n,t){function i(e,n){for(var t=e.toLowerCase().split(/-|\+/),i={ctrlKey:"",altKey:"",shiftKey:""},e=t[t.length-1],a=0;a<t.length-1;a++)switch(t[a]){case"c":i.ctrlKey="c-";break;case"a":i.altKey="a-";break;case"s":i.shiftKey="s-"}e=i.ctrlKey+i.altKey+i.shiftKey+e,p[e]=n}function a(e,n,t){f[e]=n,u('[data-action="'+e+'"]').click(function(e){return e.preventDefault(),e.stopPropagation(),n(),!1}),"undefined"!=typeof t&&t.forEach(function(n){d.hasOwnProperty(n)||(d[n]=[]),d[n].push(e)})}function r(e){f[e]()}function o(e){d.hasOwnProperty(e)&&d[e].forEach(function(e){c(e)})}function l(e){d.hasOwnProperty(e)&&d[e].forEach(function(e){s(e)})}function c(e){"string"==typeof e?u('[data-action="'+e+'"]').attr("disabled",!1):e.forEach(c)}function s(e){"string"==typeof e?u('[data-action="'+e+'"]').attr("disabled",!0):e.forEach(s)}var u=t(0);n.define=a,n.enable=c,n.disable=s,n.enableGroup=o,n.disableGroup=l,n.activate=r,n.bind=i;var f={},d={},p={};u(window).keydown(function(e){if(!e.defaultPrevented){var n="";return e.ctrlKey&&(n+="c-"),e.altKey&&(n+="a-"),e.shiftKey&&(n+="s-"),e.metaKey&&(n+="m-"),n+=e.key.toLowerCase(),p.hasOwnProperty(n)?(r(p[n]),!1):void 0}})},function(e,n,t){var i=t(0);n.shake=function(e,n){n="undefined"==typeof n?10:n;var t=2*n;return i(e).width(i(e).width()).animate({marginLeft:"+="+n},50).animate({marginLeft:"-="+t},50).animate({marginLeft:"+="+t},50).animate({marginLeft:"-="+n},50).queue(function(){i(e).css("width","").css("margin-left","").finish()})},n.onLongPress=function(e,n){var t=!1,i=function(e){t=!0},a=function(e){t=!1};e.addEventListener("touchstart",i),e.addEventListener("touchend",a),e.addEventListener("touchcancel",a),e.addEventListener("touchmove",a),e.addEventListener("contextmenu",function(e){if(t)return n(e)})},n.setProgress=function(e,n,t){var i=e.children[0],a=e.children[1];n=Math.floor(n),n>=100?e.className="progress success":e.className="progress active",i.style.width=n+"%",i.innerText=n+"%","undefined"!=typeof t&&(a.innerText=t)},n.handleLogin=function(e){var t=i("body").data("path").replace(/\/$/,"");i("#login").find("input").prop("disabled",!1),i(".login-frame").show(),i("#login").submit(function(){var a=i(this).find('[name="request_token"]').val();return i(this).find("input").prop("disabled",!0),i.ajax({url:t,method:"post",data:{request_token:a,username:i("#username").val(),password:i("#password").val(),remember:i("#remember_remember").is(":checked")?{remember:"remember"}:null},success:function(){i(".login-frame").css({overflow:"hidden",whiteSpace:"no-wrap"}).animate({width:0},function(){i(this).hide().css({overflow:"",whiteSpace:"",width:""}),i("#login").off("submit"),i("#password").val(""),e()})},error:function(e){i("#login").find("input").prop("disabled",!1),n.shake(i(".login-frame")),i("#username").select(),i("#password").val("")},global:!1}),!1})},n.handleError=function(e,t,a,r){return 401===t.status?(i("#login-overlay").show(),i("#password").focus(),void n.handleLogin(function(){i("#login-overlay").hide(),i.ajax(a)})):("undefined"!=typeof t.responseJSON?alert(t.responseJSON.message):alert(t.responseText),n.shake(i("main > .frame")),void console.log(e,t,a,r))}},,function(e,n){function t(e){var e=e.replace(/\/[^\/]+$/,"");return""===e?"/":e}function i(e){return e.replace(/^.*\//,"")}function a(e,n){e=e.trim(),e.startsWith("/")||(e=n+"/"+e);for(var t=e.split("/"),i=[],a=0;a<t.length;a++)".."===t[a]?i.length>=1&&i.pop():""!==t[a]&&"."!==t[a]&&i.push(t[a]);return"/"+i.join("/")}n.dirName=t,n.fileName=i,n.convert=a},function(e,n){var t;t=function(){return this}();try{t=t||Function("return this")()||(0,eval)("this")}catch(i){"object"==typeof window&&(t=window)}e.exports=t},,function(e,n,t){(function(e,i){function a(e,n){this._id=e,this._clearFn=n}var r=t(45).nextTick,o=Function.prototype.apply,l=Array.prototype.slice,c={},s=0;n.setTimeout=function(){return new a(o.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new a(o.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(e){e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(e,n){clearTimeout(e._idleTimeoutId),e._idleTimeout=n},n.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var n=e._idleTimeout;n>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},n))},n.setImmediate="function"==typeof e?e:function(e){var t=s++,i=!(arguments.length<2)&&l.call(arguments,1);return c[t]=!0,r(function(){c[t]&&(i?e.apply(null,i):e.call(null),n.clearImmediate(t))}),t},n.clearImmediate="function"==typeof i?i:function(e){delete c[e]}}).call(n,t(7).setImmediate,t(7).clearImmediate)},,,,,,,,,function(e,n,t){"use strict";(function(n){function i(e,n){function t(e){return ue.containers.indexOf(e)!==-1||se.isContainer(e)}function i(e){var n=e?"remove":"add";a(T,n,"mousedown",k),a(T,n,"mouseup",G)}function l(e){var n=e?"remove":"add";a(T,n,"mousemove",S)}function v(e){var n=e?"remove":"add";b[n](T,"selectstart",E),b[n](T,"click",E)}function g(){i(!0),G({})}function E(e){le&&e.preventDefault()}function k(e){ne=e.clientX,te=e.clientY;var n=1!==r(e)||e.metaKey||e.ctrlKey;if(!n){var t=e.target,i=O(t);i&&(le=i,l(),"mousedown"===e.type&&(h(t)?t.focus():e.preventDefault()))}}function S(e){if(le){if(0===r(e))return void G({});if(void 0===e.clientX||e.clientX!==ne||void 0===e.clientY||e.clientY!==te){if(se.ignoreInputTextSelection){var n=y("clientX",e),t=y("clientY",e),i=x.elementFromPoint(n,t);if(h(i))return}var a=le;l(!0),v(),K(),I(a);var c=o(Q);Z=y("pageX",e)-c.left,ee=y("pageY",e)-c.top,C.add(re||Q,"gu-transit"),Y(),F(e)}}}function O(e){if(!(ue.dragging&&z||t(e))){for(var n=e;p(e)&&t(p(e))===!1;){if(se.invalid(e,n))return;if(e=p(e),!e)return}var i=p(e);if(i&&!se.invalid(e,n)){var a=se.moves(e,i,n,m(e));if(a)return{item:e,source:i}}}}function L(e){return!!O(e)}function P(e){var n=O(e);n&&I(n)}function I(e){$(e.item,e.source)&&(re=e.item.cloneNode(!0),ue.emit("cloned",re,e.item,"copy")),W=e.source,Q=e.item,ie=ae=m(e.item),ue.dragging=!0,ue.emit("drag",Q,W)}function N(){return!1}function K(){if(ue.dragging){var e=re||Q;R(e,p(e))}}function _(){le=!1,l(!0),v(!0)}function G(e){if(_(),ue.dragging){var n=re||Q,t=y("clientX",e),i=y("clientY",e),a=c(z,t,i),r=X(a,t,i);r&&(re&&se.copySortSource||!re||r!==W)?R(n,r):se.removeOnSpill?j():q()}}function R(e,n){var t=p(e);re&&se.copySortSource&&n===W&&t.removeChild(Q),A(n)?ue.emit("cancel",e,W,W):ue.emit("drop",e,n,W,ae),D()}function j(){if(ue.dragging){var e=re||Q,n=p(e);n&&n.removeChild(e),ue.emit(re?"cancel":"remove",e,n,W),D()}}function q(e){if(ue.dragging){var n=arguments.length>0?e:se.revertOnSpill,t=re||Q,i=p(t),a=A(i);a===!1&&n&&(re?i&&i.removeChild(re):W.insertBefore(t,ie)),a||n?ue.emit("cancel",t,W,W):ue.emit("drop",t,i,W,ae),D()}}function D(){var e=re||Q;_(),B(),e&&C.rm(e,"gu-transit"),oe&&clearTimeout(oe),ue.dragging=!1,ce&&ue.emit("out",e,ce,W),ue.emit("dragend",e),W=Q=re=ie=ae=oe=ce=null}function A(e,n){var t;return t=void 0!==n?n:z?ae:m(re||Q),e===W&&t===ie}function X(e,n,i){function a(){var a=t(r);if(a===!1)return!1;var o=J(r,e),l=H(r,o,n,i),c=A(r,l);return!!c||se.accepts(Q,r,W,l)}for(var r=e;r&&!a();)r=p(r);return r}function F(e){function n(e){ue.emit(e,s,ce,W)}function t(){d&&n("over")}function i(){ce&&n("out")}if(z){e.preventDefault();var a=y("clientX",e),r=y("clientY",e),o=a-Z,l=r-ee;z.style.left=o+"px",z.style.top=l+"px";var s=re||Q,u=c(z,a,r),f=X(u,a,r),d=null!==f&&f!==ce;(d||null===f)&&(i(),ce=f,t());var h=p(s);if(f===W&&re&&!se.copySortSource)return void(h&&h.removeChild(s));var v,g=J(f,u);if(null!==g)v=H(f,g,a,r);else{if(se.revertOnSpill!==!0||re)return void(re&&h&&h.removeChild(s));v=ie,f=W}(null===v&&d||v!==s&&v!==m(s))&&(ae=v,f.insertBefore(s,v),ue.emit("shadow",s,f,W))}}function M(e){C.rm(e,"gu-hide")}function U(e){ue.dragging&&C.add(e,"gu-hide")}function Y(){if(!z){var e=Q.getBoundingClientRect();z=Q.cloneNode(!0),z.style.width=f(e)+"px",z.style.height=d(e)+"px",C.rm(z,"gu-transit"),C.add(z,"gu-mirror"),se.mirrorContainer.appendChild(z),a(T,"add","mousemove",F),C.add(se.mirrorContainer,"gu-unselectable"),ue.emit("cloned",z,Q,"mirror")}}function B(){z&&(C.rm(se.mirrorContainer,"gu-unselectable"),a(T,"remove","mousemove",F),p(z).removeChild(z),z=null)}function J(e,n){for(var t=n;t!==e&&p(t)!==e;)t=p(t);return t===T?null:t}function H(e,n,t,i){function a(){var n,a,r,o=e.children.length;for(n=0;n<o;n++){if(a=e.children[n],r=a.getBoundingClientRect(),l&&r.left+r.width/2>t)return a;if(!l&&r.top+r.height/2>i)return a}return null}function r(){var e=n.getBoundingClientRect();return o(l?t>e.left+f(e)/2:i>e.top+d(e)/2)}function o(e){return e?m(n):n}var l="horizontal"===se.direction,c=n!==e?r():a();return c}function $(e,n){return"boolean"==typeof se.copy?se.copy:se.copy(e,n)}var V=arguments.length;1===V&&Array.isArray(e)===!1&&(n=e,e=[]);var z,W,Q,Z,ee,ne,te,ie,ae,re,oe,le,ce=null,se=n||{};void 0===se.moves&&(se.moves=u),void 0===se.accepts&&(se.accepts=u),void 0===se.invalid&&(se.invalid=N),void 0===se.containers&&(se.containers=e||[]),void 0===se.isContainer&&(se.isContainer=s),void 0===se.copy&&(se.copy=!1),void 0===se.copySortSource&&(se.copySortSource=!1),void 0===se.revertOnSpill&&(se.revertOnSpill=!1),void 0===se.removeOnSpill&&(se.removeOnSpill=!1),void 0===se.direction&&(se.direction="vertical"),void 0===se.ignoreInputTextSelection&&(se.ignoreInputTextSelection=!0),void 0===se.mirrorContainer&&(se.mirrorContainer=x.body);var ue=w({containers:se.containers,start:P,end:K,cancel:q,remove:j,destroy:g,canMove:L,dragging:!1});return se.removeOnSpill===!0&&ue.on("over",M).on("out",U),i(),ue}function a(e,t,i,a){var r={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},o={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},l={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};n.navigator.pointerEnabled?b[t](e,o[i],a):n.navigator.msPointerEnabled?b[t](e,l[i],a):(b[t](e,r[i],a),b[t](e,i,a))}function r(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var n=e.button;return void 0!==n?1&n?1:2&n?3:4&n?2:0:void 0}function o(e){var n=e.getBoundingClientRect();return{left:n.left+l("scrollLeft","pageXOffset"),top:n.top+l("scrollTop","pageYOffset")}}function l(e,t){return"undefined"!=typeof n[t]?n[t]:T.clientHeight?T[e]:x.body[e]}function c(e,n,t){var i,a=e||{},r=a.className;return a.className+=" gu-hide",i=x.elementFromPoint(n,t),a.className=r,i}function s(){return!1}function u(){return!0}function f(e){return e.width||e.right-e.left}function d(e){return e.height||e.bottom-e.top}function p(e){return e.parentNode===x?null:e.parentNode}function h(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||v(e)}function v(e){return!!e&&("false"!==e.contentEditable&&("true"===e.contentEditable||v(p(e))))}function m(e){function n(){var n=e;do n=n.nextSibling;while(n&&1!==n.nodeType);return n}return e.nextElementSibling||n()}function g(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}function y(e,n){var t=g(n),i={pageX:"clientX",pageY:"clientY"};return e in i&&!(e in t)&&i[e]in t&&(e=i[e]),t[e]}var w=t(36),b=t(37),C=t(40),x=document,T=x.documentElement;e.exports=i}).call(n,t(5))},,function(e,n){},,,,,,,function(e,n){e.exports=function(e,n){return Array.prototype.slice.call(e,n)}},,,,,,,,,,function(e,n,t){"use strict";var i=t(47);e.exports=function(e,n,t){e&&i(function(){e.apply(t||null,n||[])})}},function(e,n,t){"use strict";var i=t(25),a=t(35);e.exports=function(e,n){var t=n||{},r={};return void 0===e&&(e={}),e.on=function(n,t){return r[n]?r[n].push(t):r[n]=[t],e},e.once=function(n,t){return t._once=!0,e.on(n,t),e},e.off=function(n,t){var i=arguments.length;if(1===i)delete r[n];else if(0===i)r={};else{var a=r[n];if(!a)return e;a.splice(a.indexOf(t),1)}return e},e.emit=function(){var n=i(arguments);return e.emitterSnapshot(n.shift()).apply(this,n)},e.emitterSnapshot=function(n){var o=(r[n]||[]).slice(0);return function(){var r=i(arguments),l=this||e;if("error"===n&&t["throws"]!==!1&&!o.length)throw 1===r.length?r[0]:r;return o.forEach(function(i){t.async?a(i,r,l):i.apply(l,r),i._once&&e.off(n,i)}),e}},e}},function(e,n,t){"use strict";(function(n){function i(e,n,t,i){return e.addEventListener(n,t,i)}function a(e,n,t){return e.attachEvent("on"+n,s(e,n,t))}function r(e,n,t,i){return e.removeEventListener(n,t,i)}function o(e,n,t){var i=u(e,n,t);if(i)return e.detachEvent("on"+n,i)}function l(e,n,t){function i(){var e;return h.createEvent?(e=h.createEvent("Event"),e.initEvent(n,!0,!0)):h.createEventObject&&(e=h.createEventObject()),e}function a(){return new d(n,{detail:t})}var r=p.indexOf(n)===-1?a():i();e.dispatchEvent?e.dispatchEvent(r):e.fireEvent("on"+n,r)}function c(e,t,i){return function(t){var a=t||n.event;a.target=a.target||a.srcElement,a.preventDefault=a.preventDefault||function(){a.returnValue=!1},a.stopPropagation=a.stopPropagation||function(){a.cancelBubble=!0},a.which=a.which||a.keyCode,i.call(e,a)}}function s(e,n,t){var i=u(e,n,t)||c(e,n,t);return g.push({wrapper:i,element:e,type:n,fn:t}),i}function u(e,n,t){var i=f(e,n,t);if(i){var a=g[i].wrapper;return g.splice(i,1),a}}function f(e,n,t){var i,a;for(i=0;i<g.length;i++)if(a=g[i],a.element===e&&a.type===n&&a.fn===t)return i}var d=t(39),p=t(38),h=n.document,v=i,m=r,g=[];n.addEventListener||(v=a,m=o),e.exports={add:v,remove:m,fabricate:l}}).call(n,t(5))},function(e,n,t){"use strict";(function(n){var t=[],i="",a=/^on/;for(i in n)a.test(i)&&t.push(i.slice(2));e.exports=t}).call(n,t(5))},function(e,n,t){(function(n){function t(){try{var e=new i("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(n){}return!1}var i=n.CustomEvent;e.exports=t()?i:"function"==typeof document.createEvent?function(e,n){var t=document.createEvent("CustomEvent");return n?t.initCustomEvent(e,n.bubbles,n.cancelable,n.detail):t.initCustomEvent(e,!1,!1,void 0),t}:function(e,n){var t=document.createEventObject();return t.type=e,n?(t.bubbles=Boolean(n.bubbles),t.cancelable=Boolean(n.cancelable),t.detail=n.detail):(t.bubbles=!1,t.cancelable=!1,t.detail=void 0),t}}).call(n,t(5))},function(e,n){"use strict";function t(e){var n=r[e];return n?n.lastIndex=0:r[e]=n=new RegExp(o+e+l,"g"),n}function i(e,n){var i=e.className;i.length?t(n).test(i)||(e.className+=" "+n):e.className=n}function a(e,n){e.className=e.className.replace(t(n)," ").trim()}var r={},o="(?:^|\\s)",l="(?:\\s|$)";e.exports={add:i,rm:a}},,,,,function(e,n){function t(e){if(c===setTimeout)return setTimeout(e,0);try{return c(e,0)}catch(n){try{return c.call(null,e,0)}catch(n){return c.call(this,e,0)}}}function i(e){if(s===clearTimeout)return clearTimeout(e);try{return s(e)}catch(n){try{return s.call(null,e)}catch(n){return s.call(this,e)}}}function a(){p&&f&&(p=!1,f.length?d=f.concat(d):h=-1,d.length&&r())}function r(){if(!p){var e=t(a);p=!0;for(var n=d.length;n;){for(f=d,d=[];++h<n;)f&&f[h].run();h=-1,n=d.length}f=null,p=!1,i(e)}}function o(e,n){this.fun=e,this.array=n}function l(){}var c,s,u=e.exports={};!function(){try{c=setTimeout}catch(e){c=function(){throw new Error("setTimeout is not defined")}}try{s=clearTimeout}catch(e){s=function(){throw new Error("clearTimeout is not defined")}}}();var f,d=[],p=!1,h=-1;u.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)n[i-1]=arguments[i];d.push(new o(e,n)),1!==d.length||p||t(r)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=l,u.addListener=l,u.once=l,u.off=l,u.removeListener=l,u.removeAllListeners=l,u.emit=l,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},,function(e,n,t){(function(n){var t,i="function"==typeof n;t=i?function(e){n(e)}:function(e){setTimeout(e,0)},e.exports=t}).call(n,t(7).setImmediate)},,,,,function(e,n,t){function i(e){location.href=k+"/open?path="+e}function a(e){e.on("dragenter",function(n){return null===e.data("path")||event.dataTransfer.types.indexOf("Files")<0?event.dataTransfer.dropEffect="none":(event.dataTransfer.dropEffect="copy",e.addClass("accept")),!1}),e.on("dragleave",function(n){return e.removeClass("accept"),!1}),e.on("dragover",function(n){return null===e.data("path")||event.dataTransfer.types.indexOf("Files")<0?event.dataTransfer.dropEffect="none":(event.dataTransfer.dropEffect="copy",e.addClass("accept")),!1}),e.on("drop",function(n){if(null===e.data("path"))return!1;e.removeClass("accept");var t=event.dataTransfer.files,i=new FormData;i.append("request_token",O);for(var a=0;a<t.length;a++)i.append("file"+a,t[a]),l(e,{name:t[a].name,path:e.data("path")+"/"+t[a].name,type:"uploading"});var r=new XMLHttpRequest,o=function(){"undefined"!=typeof r.responseJSON?alert(r.responseJSON.message):alert(r.responseText),T.shake(C("main > .frame"))};return r.open("POST",k+"/api/upload?path="+e.data("path")),r.send(i),r.onreadystatechange=function(){if(4===this.readyState){200!==this.status&&o();var n=e.data("path");e.data("path",null),g(e,n)}},!1})}function r(e,n){_[n.path]={link:e,data:n},e.hasClass("file-directory")||e.dblclick(function(){if(!q)return i(C(this).data("path")),!1}),T.onLongPress(e[0],function(t){return t.preventDefault(),t.stopPropagation(),e.hasClass("active")?p(n.path):h(n.path),q=!0,!1}),e.on("dragstart",function(e){var t="application/octet-stream:"+encodeURIComponent(n.name)+":"+location.origin+k+"/api/download?path="+encodeURIComponent(n.path);e.originalEvent.dataTransfer.setData("DownloadURL",t)}),e.click(function(t){if(t.ctrlKey||q)e.hasClass("active")?p(n.path):h(n.path);else if(t.shiftKey){var i=G[G.length-1],a=R;if(e.hasClass("active")||h(n.path),R!==a&&(i=G[0]),_.hasOwnProperty(i)){var r=_[i].link;if(r.parent().is(e.parent())){var o=!1;e.parent().children().each(function(){var n=C(this);(n.is(e)||n.is(r))&&(o=!o),o&&!n.hasClass("active")&&h(n.data("path"))})}}}else f(n.path);return!1})}function o(e){var n=C('<a class="file">');return n.text(e.name),N.filter(function(n){return n===e.path}).length>0&&n.addClass("active"),e.read||n.addClass("locked"),n.attr("draggable",!0),n.attr("data-path",e.path),n.attr("href",k+"/files?path="+e.path),n.addClass("file-"+e.type),r(n,e),n}function l(e,n){var t=o(n);return e.children(".files-list").append(t),t}function c(e,n){_.hasOwnProperty(n.path)||o(n);var t,a=C('<div class="file-info">'),r="Edit";switch(n.type.toLowerCase()){case"jpeg":case"jpg":case"png":case"ico":t=C('<img class="file-thumbnail">'),t.attr("src",k+"/api/download?path="+encodeURIComponent(n.path)),r="View";break;case"webm":r="Play";default:t=C('<span class="file">'),t.addClass("file-"+n.type),n.read||t.addClass("locked")}var l=C('<span class="file-name">');l.text(n.name);var c=C('<span class="file-modified">');c.text(new Date(1e3*n.modified).toString());var s=C('<span class="file-access">');if(s.text(n.modeString+" "+n.owner+":"+n.group+" ("+(n.read?"r":"-")+(n.write?"w":"-")+")"),a.append(t).append(l).append(c).append(s),n.read){var u=C("<button>"+r+"</button>");u.click(function(){i(n.path)}).appendTo(a)}e.children(".files-list").replaceWith(a)}function s(){N.length<=1||(N.pop(),I=N[N.length-1],q=!1,N.length>1?(G=[I],x.enableGroup("selection"),x.enableGroup("selection-single")):(G=[],x.disableGroup("selection"),x.disableGroup("selection-single")),R=N[N.length-1],m(),history.pushState({cwd:I},document.title,k+"/files?path="+I))}function u(){P.data("path",null),g(P,I)}function f(e){v(e),_.hasOwnProperty(e)&&_[e].link.addClass("active"),history.pushState({cwd:I},document.title,k+"/files?path="+I)}function d(){return 1===G.length&&G[0]===R?void s():(G.forEach(function(e){_[e].link.removeClass("active")}),G=[],q=!1,x.disableGroup("selection"),x.disableGroup("selection-single"),void f(R))}function p(e){var n=G.indexOf(e);if(n>=0)if(G.splice(n,1),console.log(G),_[e].link.removeClass("active"),0===G.length)q=!1,P.next().children(".file-info").empty(),f(R);else{1===G.length?x.enableGroup("selection-single"):x.disableGroup("selection-single");var t=P.next().children(".file-info");if(t.length>0){var i=t.children(".file-name");i.text(G.length+" files")}}}function h(e){var n=E.dirName(e);if(n!==R){if(G.length>1)return;R=n;for(var t=[],i=0;i<N.length;i++)if(N[i]===R&&i+1<N.length){t.push(N[i+1]);break}v(n),G=t,G.length>0&&_[G[0]].link.addClass("active")}else 1===G.length&&E.dirName(G[0])!==R&&(G=[]);x.enableGroup("selection"),G.push(e),x.disableGroup("dir"),1===G.length?x.enableGroup("selection-single"):x.disableGroup("selection-single"),console.log(G,R),_[e].link.addClass("active");var a=P.next().children(".file-info");if(a.length>0){a.empty();var r=C('<span class="file file-multiple">'),o=C('<span class="file-name">');o.text(G.length+" files"),a.append(r).append(o)}else if(P.next().length>0){P.next().empty();var a=C('<div class="file-info">');a.appendTo(P.next());var r=C('<span class="file file-multiple">'),o=C('<span class="file-name">');o.text(G.length+" files"),a.append(r).append(o)}}function v(e){var n=e.split("/"),e="";N=["/"];for(var t=0;t<n.length;t++)".."===n[t]?N.length>1&&(N.pop(),e=N[N.length-1]):""!==n[t]&&"."!==n[t]&&(e+="/"+n[t],N.push(e));I=N[N.length-1],q=!1,N.length>1?(G=[e],x.enableGroup("selection"),x.enableGroup("selection-single")):(G=[],x.disableGroup("selection"),x.disableGroup("selection-single")),R=N[N.length-1],m()}function m(){console.log("stack",N,"cwd",I,"stackOffset",j);var e=S.children(),n=e.length;if(j=Math.max(0,N.length-n),S.find("a").removeClass("active"),P.children(".filter").remove(),P=e.eq(Math.min(n,N.length)-1),N.length>=K)for(var t=0;t<n;t++){var i=e.eq(t);j+t<N.length?g(i,N[j+t]):g(i,null)}else for(var t=n-1;t>=0;t--){var i=e.eq(t);j+t<N.length?g(i,N[j+t]):g(i,null)}K=N.length,C(".header-path").text(I),document.title=I+" – Files"}function g(e,n){if(e.data("path")!==n||null===n){var t=e.children(".files-list");0===t.length&&(e.empty(),t=C('<div class="files-list">'),e.append(t)),t.empty(),e.data("path",null),e.removeClass("readonly"),e.next().data("path")===n?(e.data("path",n),e.next().children(".files-list").children().appendTo(t),e.next().hasClass("readonly")&&e.addClass("readonly")):e.prev().data("path")===n?(e.data("path",n),e.prev().children(".files-list").children().appendTo(t),e.prev().hasClass("readonly")&&e.addClass("readonly")):null!==n&&(e.addClass("loading"),C.ajax({url:k+"/api/list-files",data:{path:n},success:function(i){if(e.removeClass("loading"),t.empty(),e.removeClass("readonly"),e.data("path",n),i.write||e.addClass("readonly"),_.hasOwnProperty(i.path)||o(i),"directory"===i.type&&"undefined"!=typeof i.files){for(var a=0;a<i.files.length;a++){var r=i.files[a];l(e,r)}e.is(P)&&x.enableGroup("dir")}else c(e,i),e.is(P)&&x.disableGroup("dir");e.trigger("loaded")}}))}_.hasOwnProperty(n)&&(_[n].link.addClass("active"),e.is(P)&&("directory"===_[n].data.type?x.enableGroup("dir"):x.disableGroup("dir")))}function y(){var e=S.children().length,n=Math.max(1,Math.floor(S.width()/200));if(n>e)for(var t=n-e,i=0;i<t;i++){var r=C('<div class="files-panel">');r.append('<div class="files-list">'),r.appendTo(S),a(r)}else{if(!(n<e))return!1;for(var o=e-n,i=0;i<o;i++)S.children().last().remove()}return S.children().css("width",100/n+"%"),!0}function w(e){var n=!0;e===e.toLowerCase()&&(n=!1);var t=null;return P.find(".file").each(function(){var i=C(this).text();if(n||(i=i.toLowerCase()),i.slice(0,e.length)===e)return t=C(this),!1}),t}function b(){var e=P.children(".filter");if(P.find(".match").removeClass("match"),e.length>0)if(""===e.val())e.remove();else{var n=w(e.val());null!==n&&n.addClass("match")}}var C=t(0),x=t(1),T=t(2),E=t(4);t(16);t(18);var k=C("body").data("path").replace(/\/$/,""),S=C(".files-columns"),O=S.data("token"),L=C(".files-shelf > .files-grid"),P=S.children().first(),I=P.data("path");P.data("path",null);var N=[],K=0,_={},G=[],R="/",j=0;C(document).ajaxError(T.handleError);var q=!1,D=I;window.onpopstate=function(e){null!==e.state?v(e.state.cwd):D!==I&&v(D)},C(window).keydown(function(e){if(!e.defaultPrevented&&!(C("input:focus").length>0||e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)){var n=P.children(".filter");if(1===e.key.length)return 0===n.length?(C('<input type="text" class="filter">').val(e.key).appendTo(P).focus().keydown(function(e){if(!(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)){if("Escape"===e.key)return C(this).remove(),b(),!1;if("Enter"===e.key){var n=P.find(".match");return n.length>0&&(C(this).remove(),n.click()),!1}}}).keyup(b).blur(function(){C(this).remove(),b()}),b(),!1):void 0}}),x.define("back",function(){history.back()},["nav"]),x.define("foreward",function(){history.go(1)},["nav"]),x.define("up",function(){s()},["nav"]),x.define("home",function(){f("/")},["nav"]),x.define("new-folder",function(){var e=prompt("Enter the new name:");if(null!==e){if(""===e)return void alert("Invalid name");var n;n="/"===I?I+e:I+"/"+e,C.ajax({url:k+"/api/make-dir",method:"post",data:{request_token:O,path:n},success:function(e){l(P,e),f(n)}})}},["dir"]),x.define("new-file",function(){var e=prompt("Enter the new name:");if(null!==e){if(""===e)return void alert("Invalid name");var n;n="/"===I?I+e:I+"/"+e,C.ajax({url:k+"/api/make-file",method:"post",data:{request_token:O,path:n},success:function(e){l(P,e),f(n)}})}},["dir"]),x.define("upload",function(){var e=C('<input type="file" />').appendTo(C("body")),n=P;e.hide(),e.click(),e.change(function(){var t=e[0].files,i=new FormData;i.append("request_token",O);for(var a=0;a<t.length;a++)i.append("file"+a,t[a]),l(n,{name:t[a].name,path:n.data("path")+"/"+t[a].name,type:"uploading"});var r=new XMLHttpRequest,o=function(){"undefined"!=typeof r.responseJSON?alert(r.responseJSON.message):alert(r.responseText),T.shake(C("main > .frame"))};return r.open("POST",k+"/api/upload?path="+encodeURIComponent(n.data("path"))),r.onreadystatechange=function(){if(4===this.readyState){200!==this.status&&o();var t=n.data("path");n.data("path",null),g(n,t),e.remove()}},r.send(i),!1})},["dir"]),x.define("terminal",function(){location.href=k+"/terminal?path="+I},["selection-single"]),x.define("rename",function(){if(!(N.length<=1)){if(1!==G.length)return void alert("Cannot rename multiple files");var e=G[0],n=prompt("Enter the new name:",_[e].data.name);if(null!==n){""===n&&alert("Invalid name");var t=E.convert(n,E.dirName(e));C.ajax({url:k+"/api/move",method:"post",data:{request_token:O,path:e,destination:t},success:function(e){f(t),u()}})}}},["selection-single"]),x.define("trash",function(){var e,n={request_token:O};1===G.length?(e=confirm("Permanently delete file: "+G[0]),n.path=G[0]):(e=confirm("Permanently delete "+G.length+" files?"),n.paths=G),e&&C.ajax({url:k+"/api/delete",method:"post",data:n,success:function(e){d(),u()}})},["selection"]),x.define("download",function(){if(1===G.length){var e=_[G[0]].data;location.href=k+"/api/download/"+encodeURIComponent(e.name)+"?force&path="+encodeURIComponent(e.path)}else for(var n=0;n<G.length;n++){var e=_[G[n]].data,t=C("<iframe>");t.hide(),t.attr("src",k+"/api/download/"+encodeURIComponent(e.name)+"?force&path="+encodeURIComponent(e.path)),t.on("load",function(){console.log("download finished"),t.remove()}),t.appendTo(C("body"))}},["selection"]),x.define("cut",function(){if(1===G.length)_[G[0]].link.clone().removeClass("active").appendTo(L);else{var e=G,n=C('<a class="file file-multiple">');n.text(G.length+" files"),n.data("paths",e),n.appendTo(L)}d()},["selection"]),x.define("copy",function(){if(1===G.length)_[G[0]].link.clone().removeClass("active").addClass("duplicate").appendTo(L);else{var e=G,n=C('<a class="file file-multiple duplicate">');n.text(G.length+" files"),n.data("paths",e),n.appendTo(L)}d()},["selection"]),x.define("paste",function(){if(L.children().length>0){var e=L.children().last(),n=e.hasClass("duplicate"),t={request_token:O},i=[];if("undefined"!=typeof e.data("paths"))t.paths={},e.data("paths").forEach(function(e){t.paths[e]=E.convert(_[e].data.name,I),i.push(_[e])});else{t.path=e.data("path");var a=_[t.path];t.destination=E.convert(a.data.name,I),i.push(a)}C.ajax({url:k+(n?"/api/copy":"/api/move"),method:"post",data:t,success:function(t){e.remove(),n||i.forEach(function(e){e.link.remove()}),u()}})}},["dir"]),x.define("select-all",function(){P.find(".file").each(function(){h(C(this).data("path"))})},["dir"]),x.define("remove-selection",function(){1===G.length&&G[0]===R||d()},["dir"]),x.define("focus-prev",function(){var e=P.find(".file:focus");if(e.length>0){var n=e.prev();n.length>0&&n.focus()}else P.find(".file").last().focus()},["nav"]),x.define("focus-next",function(){var e=P.find(".file:focus");if(e.length>0){var n=e.next();n.length>0&&n.focus()}else P.find(".file").first().focus()},["nav"]),x.define("enter",function(){var e=P.find(".file:focus");e.length>0&&(f(e.data("path")),P.one("loaded",function(){C(this).find(".file").first().focus()}))},["nav"]),x.define("exit",function(){if(N.length>1){var e=I;s(),_[e].link.focus()}},["nav"]),x.bind("F2","rename"),x.bind("C-C","copy"),x.bind("C-X","cut"),x.bind("C-V","paste"),x.bind("Delete","trash"),x.bind("C-A","select-all"),x.bind("Escape","remove-selection"),x.bind("C-H","exit"),x.bind("C-K","focus-prev"),x.bind("C-J","focus-next"),x.bind("C-L","enter"),x.bind("ArrowLeft","exit"),x.bind("ArrowUp","focus-prev"),x.bind("ArrowDown","focus-next"),x.bind("ArrowRight","enter"),x.disableGroup("selection"),x.disableGroup("selection-single"),x.disableGroup("dir"),S.empty(),y(),v(I),S.click(function(e){e.defaultPrevented||1===G.length&&G[0]===R||d()}),C(window).resize(function(){y()&&m()})}],[52]);
//# sourceMappingURL=files.js.map
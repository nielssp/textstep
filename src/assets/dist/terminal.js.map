{"version":3,"sources":["webpack:///dist/terminal.js","webpack:///./common/ui.js?8332***","webpack:///./common/actions.js?e0fb***","webpack:///./terminal.js"],"names":["webpackJsonp","2","module","exports","__webpack_require__","$","shake","el","amount","dbl","width","animate","marginLeft","queue","css","finish","onLongPress","callback","touching","start","e","end","addEventListener","setProgress","progress","status","bar","children","label","Math","floor","className","style","innerText","handleLogin","done","path","data","replace","find","prop","submit","token","this","val","ajax","url","method","request_token","username","password","remember","is","success","off","error","xhr","select","global","handleError","event","settings","thrownError","show","focus","hide","responseJSON","alert","message","responseText","console","log","3","bind","key","action","parts","toLowerCase","split","ctrlKey","altKey","shiftKey","length","i","keyMap","defineAction","name","actions","click","preventDefault","stopPropagation","activate","enable","attr","forEach","disable","define","window","keydown","defaultPrevented","hasOwnProperty","55","convertPath","trim","startsWith","user","home","substr","cwd","names","stack","pop","push","join","flush","$terminal","buffer","scrollTop","scrollHeight","write","content","writeLine","readLine","readCallback","exec","command","TOKEN","PATH","ui","code","statusText","complete","prompt","cmdHistoryPos","line","m","match","commands","JSON","parse","stringify","cmdHistory","months","location","href","clear","args","cd","nwd","type","pwd","ls","files","file","modeString","owner","group","date","Date","modified","getFullYear","getMonth","getDate","touch","mkdir","rm","cp","destination","mv","cat","exit","open","edit","cedit","selectionStart","selectionEnd","blur"],"mappings":"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","file":"dist/terminal.js","sourcesContent":["webpackJsonp([5],{\n\n/***/ 2:\n/***/ function(module, exports, __webpack_require__) {\n\n/*\n * BlogSTEP\n * Copyright (c) 2016 Niels Sonnich Poulsen (http://nielssp.dk)\n * Licensed under the MIT license.\n * See the LICENSE file or http://opensource.org/licenses/MIT for more information.\n */\n\nvar $ = __webpack_require__(0);\n\nexports.shake = function (el, amount) {\n    amount = typeof amount === \"undefined\" ? 10 : amount;\n    var dbl = amount * 2;\n    return $(el).width($(el).width())\n            .animate({marginLeft: '+=' + amount}, 50)\n            .animate({marginLeft: '-=' + dbl}, 50)\n            .animate({marginLeft: '+=' + dbl}, 50)\n            .animate({marginLeft: '-=' + amount}, 50)\n            .queue(function () {\n                $(el).css('width', '')\n                        .css('margin-left', '')\n                        .finish();\n            });\n};\n\nexports.onLongPress = function(el, callback) {\n    var touching = false;\n    \n    var start = function (e) {\n        touching = true;\n    };\n    \n    var end = function (e) {\n        touching = false;\n    };\n    \n    el.addEventListener('touchstart', start);\n    el.addEventListener('touchend', end);\n    el.addEventListener('touchcancel', end);\n    el.addEventListener('touchmove', end);\n    el.addEventListener('contextmenu', function (e) {\n        if (touching) {\n            return callback(e);\n        }\n    });\n};\n\nexports.setProgress = function(el, progress, status) {\n    var bar = el.children[0];\n    var label = el.children[1];\n    progress = Math.floor(progress);\n    if (progress >= 100) {\n        el.className = 'progress success';\n    } else {\n        el.className = 'progress active';\n    }\n    bar.style.width = progress + '%';\n    bar.innerText = progress + '%';\n    if (typeof status !== 'undefined') {\n        label.innerText = status;\n    }\n};\n\nexports.handleLogin = function (done) {\n    var path = $('body').data('path').replace(/\\/$/, '');\n    $('#login').find('input').prop('disabled', false);\n    $('#login').submit(function () {\n        var token = $(this).find('[name=\"request_token\"]').val();\n        $(this).find('input').prop('disabled', true);\n        $.ajax({\n            url: path,\n            method: 'post',\n            data: {\n                request_token: token,\n                username: $('#username').val(),\n                password: $('#password').val(),\n                remember: $('#remember_remember').is(':checked') ? { remember: 'remember' } : null\n            },\n            success: function () {\n                $('#login').off('submit');\n                $('#password').val('');\n                done();\n            },\n            error: function (xhr) {\n                $('#login').find('input').prop('disabled', false);\n                exports.shake($('.login-frame'));\n                $('#username').select();\n                $('#password').val('');\n            },\n            global: false\n        });\n        return false;\n    });\n};\n\nexports.handleError = function (event, xhr, settings, thrownError) {\n    if (xhr.status === 401) {\n        $('#login-overlay').show();\n        $('#password').focus();\n        exports.handleLogin(function () {\n            $('#login-overlay').hide();\n            $.ajax(settings);\n        });\n        return;\n    } else if (typeof xhr.responseJSON !== 'undefined') {\n        alert(xhr.responseJSON.message);\n    } else {\n        alert(xhr.responseText);\n    }\n    exports.shake($('main > .frame'));\n    console.log(event, xhr, settings, thrownError);\n};\n\n\n/***/ },\n\n/***/ 3:\n/***/ function(module, exports, __webpack_require__) {\n\n/*\n * BlogSTEP \n * Copyright (c) 2016 Niels Sonnich Poulsen (http://nielssp.dk)\n * Licensed under the MIT license.\n * See the LICENSE file or http://opensource.org/licenses/MIT for more information.\n */\n\nvar $ = __webpack_require__(0);\n\nexports.define = defineAction;\nexports.enable = enable;\nexports.disable = disable;\nexports.activate = activate;\nexports.bind = bind;\n\nvar actions = {};\n\nvar keyMap = {};\n\n$(window).keydown(function (e) {\n    if (e.defaultPrevented) {\n        return;\n    }\n    var key = '';\n    if (e.ctrlKey) {\n        key += 'c-';\n    }\n    if (e.altKey) {\n        key += 'a-';\n    }\n    if (e.shiftKey) {\n        key += 's-';\n    }\n    key += e.key.toLowerCase();\n    console.log('pressed ' + key);\n    if (keyMap.hasOwnProperty(key)) {\n        activate(keyMap[key]);\n        return false;\n    }\n});\n\nfunction bind(key, action)\n{\n    var parts = key.toLowerCase().split(/-|\\+/);\n    var e = { ctrlKey: '', altKey: '', shiftKey: '' };\n    var key = parts[parts.length - 1];\n    for (var i = 0; i < parts.length - 1; i++) {\n        switch (parts[i]) {\n            case 'c':\n                e.ctrlKey = 'c-';\n                break;\n            case 'a':\n                e.altKey = 'a-';\n                break;\n            case 's':\n                e.shiftKey = 's-';\n                break;\n        }\n    }\n    key = e.ctrlKey + e.altKey + e.shiftKey + key;\n    keyMap[key] = action;\n}\n\nfunction defineAction(name, callback)\n{\n    actions[name] = callback;\n    $('[data-action=\"' + name + '\"]').click(function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        callback();\n        return false;\n    });\n}\n\nfunction activate(name)\n{\n    actions[name]();\n}\n\nfunction enable(name)\n{\n    if (typeof name === 'string') {\n        $('[data-action=\"' + name + '\"]').attr('disabled', false);\n    } else {\n        name.forEach(enable);\n    }\n}\n\nfunction disable(name)\n{\n    if (typeof name === 'string') {\n        $('[data-action=\"' + name + '\"]').attr('disabled', true);\n    } else {\n        name.forEach(disable);\n    }\n}\n\n/***/ },\n\n/***/ 55:\n/***/ function(module, exports, __webpack_require__) {\n\n/*\n * BlogSTEP \n * Copyright (c) 2016 Niels Sonnich Poulsen (http://nielssp.dk)\n * Licensed under the MIT license.\n * See the LICENSE file or http://opensource.org/licenses/MIT for more information.\n */\n\nvar $ = __webpack_require__(0);\nvar actions = __webpack_require__(3);\nvar ui = __webpack_require__(2);\n\nvar $terminal = $('#terminal');\n\nvar buffer = '';\nvar cmdHistory = [];\nvar cmdHistoryPos = -1;\nvar readCallback = null;\n\nvar user = {};\nvar cwd = '/';\n\nvar PATH = $('body').data('path').replace(/\\/$/, '');\nvar TOKEN = $terminal.data('token');\n\nvar months = [\n    'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',\n    'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'\n];\n\nactions.define('close', function () {\n    location.href = PATH + '/files' + cwd;\n});\n\nfunction convertPath(path)\n{\n    path = path.trim();\n    if (path.startsWith('~')) {\n        path = user.home + path.substr(1);\n    } else if (!path.startsWith('/')) {\n        path = cwd + '/' + path;\n    }\n    var names = path.split('/');\n    var stack = [];\n    for (var i = 0; i < names.length; i++) {\n        if (names[i] === '..') {\n            if (stack.length >= 1) {\n                stack.pop();\n            }\n        } else if (names[i] !== '' && names[i] !== '.') {\n            stack.push(names[i]);\n        }\n    }\n    return '/' + stack.join('/');\n}\n\nvar commands = {\n    clear: function (args) {\n        buffer = '';\n        flush();\n        prompt();\n    },\n    cd: function (args) {\n        var nwd = convertPath(args);\n        exec('list-files?path=' + nwd, {}, function (data) {\n            if (data.type === 'directory') {\n                cwd = nwd;\n            } else {\n                writeLine('not a directory');\n            }\n        });\n    },\n    pwd: function (args) {\n        writeLine(cwd);\n        prompt();\n    },\n    ls: function (args) {\n        exec('list-files?path=' + cwd, {}, function (data) {\n            if (typeof data.files !== 'undefined') {\n                data.files.forEach(function (file) {\n                    var line = file.modeString;\n                    line += ' \\t' + file.owner;\n                    line += ' \\t' + file.group;\n                    var date = new Date(file.modified * 1000);\n                    line += ' \\t' + date.getFullYear();\n                    line += ' ' + months[date.getMonth()];\n                    line += ' ' + date.getDate();\n                    line += ' \\t' + file.name;\n                    if (file.type === 'directory') {\n                        line += '/';\n                    }\n                    writeLine(line);\n                });\n            }\n        });\n    },\n    touch: function (args) {\n        exec('make-file', {path: convertPath(args)}, function (data) {\n        });\n    },\n    mkdir: function (args) {\n        exec('make-dir', {path: convertPath(args)}, function (data) {\n        });\n    },\n    rm: function (args) {\n        exec('delete', {path: convertPath(args)}, function (data) {\n        });\n    },\n    cp: function (args) {\n        args = args.split(' ');\n        exec('copy', {path: convertPath(args[0]), destination: convertPath(args[1])}, function (data) {\n        });\n    },\n    mv: function (args) {\n        args = args.split(' ');\n        exec('move', {path: convertPath(args[0]), destination: convertPath(args[1])}, function (data) {\n        });\n    },\n    cat: function (args) {\n        exec('download?path=' + convertPath(args), {}, function (data) {\n            writeLine(data);\n        });\n    },\n    exit: function (args) {\n        location.href = PATH + '/files' + convertPath(args);\n    },\n    open: function (args) {\n        location.href = PATH + '/open' + convertPath(args);\n    },\n    edit: function (args) {\n        location.href = PATH + '/edit' + convertPath(args);\n    },\n    cedit: function (args) {\n        location.href = PATH + '/code-edit' + convertPath(args);\n    }\n};\n\nfunction flush()\n{\n    $terminal.val(buffer);\n    $terminal[0].scrollTop = $terminal[0].scrollHeight;\n//    $terminal.scrollTop($terminal.innerHeight());\n}\n\nfunction write(content)\n{\n    buffer += content;\n    flush();\n}\n\nfunction writeLine(content)\n{\n    write(content + '\\n');\n}\n\nfunction readLine(callback)\n{\n    $terminal.attr('readonly', false).focus();\n    readCallback = callback;\n}\n\nfunction exec(command, data, success)\n{\n    data['request_token'] = TOKEN;\n    $.ajax({\n        url: PATH + '/api/' + command,\n        method: 'post',\n        data: data,\n        success: success,\n        error: function (xhr) {\n            ui.shake($('.frame'));\n            if (xhr.status === 404) {\n                writeLine(xhr.status + ' ' + command + ': command not found');\n            } else if (typeof xhr.responseJSON !== 'undefined') {\n                writeLine(xhr.status + '(' + xhr.responseJSON.code + ') ' + xhr.responseJSON.message);\n            } else {\n                writeLine(xhr.status + ' ' + xhr.statusText + ': ' + xhr.responseText);\n            }\n        },\n        complete: prompt\n    });\n}\n\nfunction prompt()\n{\n    write(user.username + ' ' + cwd + '> ');\n    cmdHistoryPos = -1;\n    readLine(function (line) {\n        var m = line.trim().match(/^([^ ]+)(?: (.*))?/);\n        if (m === null) {\n            writeLine('Invalid command');\n            prompt();\n        } else {\n            var command = m[1];\n            if (commands.hasOwnProperty(command)) {\n                commands[command]((typeof m[2] === 'undefined')? '' : m[2]);\n            } else {\n                try {\n                    var data = (typeof m[2] === 'undefined') ? {} : JSON.parse(m[2]);\n                    exec(command, data, function (data) {\n                        writeLine(JSON.stringify(data, null, '  '));\n                    });\n                } catch (e) {\n                    writeLine(e);\n                    prompt();\n                }\n            }\n        }\n    });\n}\n\n$terminal.attr('readonly', true);\n$terminal.keydown(function (e) {\n    if (e.key === 'Enter' && !e.shiftKey) {\n        if (readCallback !== null) {\n            $terminal.attr('readonly', true).blur();\n            var line = $terminal.val().substr(buffer.length);\n            cmdHistory.push(line);\n            buffer += line + '\\n';\n            flush();\n            var callback = readCallback;\n            readCallback = null;\n            callback(line);\n        }\n        e.preventDefault();\n        e.stopPropagation();\n    } else if (e.key == 'ArrowUp') {\n        if (readCallback !== null) {\n            if (cmdHistory.length > 0) {\n                if (cmdHistoryPos < 0) {\n                    cmdHistoryPos = cmdHistory.length - 1;\n                } else if (cmdHistoryPos > 0) {\n                    cmdHistoryPos--;\n                }\n                $terminal.val(buffer + cmdHistory[cmdHistoryPos]);\n            }\n        }\n        e.preventDefault();\n        e.stopPropagation();\n    } else if (e.key == 'ArrowDown') {\n        if (readCallback !== null) {\n            if (cmdHistory.length > 0 && cmdHistoryPos >= 0) {\n                if (cmdHistoryPos < cmdHistory.length - 1) {\n                    cmdHistoryPos++;\n                    $terminal.val(buffer + cmdHistory[cmdHistoryPos]);\n                } else {\n                    cmdHistoryPos = -1;\n                    $terminal.val(buffer);\n                }\n            }\n        }\n        e.preventDefault();\n        e.stopPropagation();\n    } else if (e.key == 'ArrowLeft' || e.key == 'Backspace') {\n        var start = $terminal[0].selectionStart;\n        var end = $terminal[0].selectionEnd;\n        if (start === end) {\n            if (start <= buffer.length) {\n                e.preventDefault();\n                e.stopPropagation();\n            }\n        }\n    }\n});\n\n$terminal.click(function () {\n    var start = $terminal[0].selectionStart;\n    var end = $terminal[0].selectionEnd;\n    if (start === end) {\n        if (start < buffer.length) {\n            $terminal[0].selectionStart = $terminal.val().length;\n        }\n    }\n});\n\nexec('who-am-i', {}, function (data) {\n    user = data;\n});\n\n/***/ }\n\n},[55]);\n\n\n// WEBPACK FOOTER //\n// dist/terminal.js","/*\n * BlogSTEP\n * Copyright (c) 2016 Niels Sonnich Poulsen (http://nielssp.dk)\n * Licensed under the MIT license.\n * See the LICENSE file or http://opensource.org/licenses/MIT for more information.\n */\n\nvar $ = require('jquery');\n\nexports.shake = function (el, amount) {\n    amount = typeof amount === \"undefined\" ? 10 : amount;\n    var dbl = amount * 2;\n    return $(el).width($(el).width())\n            .animate({marginLeft: '+=' + amount}, 50)\n            .animate({marginLeft: '-=' + dbl}, 50)\n            .animate({marginLeft: '+=' + dbl}, 50)\n            .animate({marginLeft: '-=' + amount}, 50)\n            .queue(function () {\n                $(el).css('width', '')\n                        .css('margin-left', '')\n                        .finish();\n            });\n};\n\nexports.onLongPress = function(el, callback) {\n    var touching = false;\n    \n    var start = function (e) {\n        touching = true;\n    };\n    \n    var end = function (e) {\n        touching = false;\n    };\n    \n    el.addEventListener('touchstart', start);\n    el.addEventListener('touchend', end);\n    el.addEventListener('touchcancel', end);\n    el.addEventListener('touchmove', end);\n    el.addEventListener('contextmenu', function (e) {\n        if (touching) {\n            return callback(e);\n        }\n    });\n};\n\nexports.setProgress = function(el, progress, status) {\n    var bar = el.children[0];\n    var label = el.children[1];\n    progress = Math.floor(progress);\n    if (progress >= 100) {\n        el.className = 'progress success';\n    } else {\n        el.className = 'progress active';\n    }\n    bar.style.width = progress + '%';\n    bar.innerText = progress + '%';\n    if (typeof status !== 'undefined') {\n        label.innerText = status;\n    }\n};\n\nexports.handleLogin = function (done) {\n    var path = $('body').data('path').replace(/\\/$/, '');\n    $('#login').find('input').prop('disabled', false);\n    $('#login').submit(function () {\n        var token = $(this).find('[name=\"request_token\"]').val();\n        $(this).find('input').prop('disabled', true);\n        $.ajax({\n            url: path,\n            method: 'post',\n            data: {\n                request_token: token,\n                username: $('#username').val(),\n                password: $('#password').val(),\n                remember: $('#remember_remember').is(':checked') ? { remember: 'remember' } : null\n            },\n            success: function () {\n                $('#login').off('submit');\n                $('#password').val('');\n                done();\n            },\n            error: function (xhr) {\n                $('#login').find('input').prop('disabled', false);\n                exports.shake($('.login-frame'));\n                $('#username').select();\n                $('#password').val('');\n            },\n            global: false\n        });\n        return false;\n    });\n};\n\nexports.handleError = function (event, xhr, settings, thrownError) {\n    if (xhr.status === 401) {\n        $('#login-overlay').show();\n        $('#password').focus();\n        exports.handleLogin(function () {\n            $('#login-overlay').hide();\n            $.ajax(settings);\n        });\n        return;\n    } else if (typeof xhr.responseJSON !== 'undefined') {\n        alert(xhr.responseJSON.message);\n    } else {\n        alert(xhr.responseText);\n    }\n    exports.shake($('main > .frame'));\n    console.log(event, xhr, settings, thrownError);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./common/ui.js\n// module id = 2\n// module chunks = 0 1 2 4 5 6 7","/*\n * BlogSTEP \n * Copyright (c) 2016 Niels Sonnich Poulsen (http://nielssp.dk)\n * Licensed under the MIT license.\n * See the LICENSE file or http://opensource.org/licenses/MIT for more information.\n */\n\nvar $ = require('jquery');\n\nexports.define = defineAction;\nexports.enable = enable;\nexports.disable = disable;\nexports.activate = activate;\nexports.bind = bind;\n\nvar actions = {};\n\nvar keyMap = {};\n\n$(window).keydown(function (e) {\n    if (e.defaultPrevented) {\n        return;\n    }\n    var key = '';\n    if (e.ctrlKey) {\n        key += 'c-';\n    }\n    if (e.altKey) {\n        key += 'a-';\n    }\n    if (e.shiftKey) {\n        key += 's-';\n    }\n    key += e.key.toLowerCase();\n    console.log('pressed ' + key);\n    if (keyMap.hasOwnProperty(key)) {\n        activate(keyMap[key]);\n        return false;\n    }\n});\n\nfunction bind(key, action)\n{\n    var parts = key.toLowerCase().split(/-|\\+/);\n    var e = { ctrlKey: '', altKey: '', shiftKey: '' };\n    var key = parts[parts.length - 1];\n    for (var i = 0; i < parts.length - 1; i++) {\n        switch (parts[i]) {\n            case 'c':\n                e.ctrlKey = 'c-';\n                break;\n            case 'a':\n                e.altKey = 'a-';\n                break;\n            case 's':\n                e.shiftKey = 's-';\n                break;\n        }\n    }\n    key = e.ctrlKey + e.altKey + e.shiftKey + key;\n    keyMap[key] = action;\n}\n\nfunction defineAction(name, callback)\n{\n    actions[name] = callback;\n    $('[data-action=\"' + name + '\"]').click(function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        callback();\n        return false;\n    });\n}\n\nfunction activate(name)\n{\n    actions[name]();\n}\n\nfunction enable(name)\n{\n    if (typeof name === 'string') {\n        $('[data-action=\"' + name + '\"]').attr('disabled', false);\n    } else {\n        name.forEach(enable);\n    }\n}\n\nfunction disable(name)\n{\n    if (typeof name === 'string') {\n        $('[data-action=\"' + name + '\"]').attr('disabled', true);\n    } else {\n        name.forEach(disable);\n    }\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./common/actions.js\n// module id = 3\n// module chunks = 0 1 2 3 4 5","/*\n * BlogSTEP \n * Copyright (c) 2016 Niels Sonnich Poulsen (http://nielssp.dk)\n * Licensed under the MIT license.\n * See the LICENSE file or http://opensource.org/licenses/MIT for more information.\n */\n\nvar $ = require('jquery');\nvar actions = require('./common/actions');\nvar ui = require('./common/ui');\n\nvar $terminal = $('#terminal');\n\nvar buffer = '';\nvar cmdHistory = [];\nvar cmdHistoryPos = -1;\nvar readCallback = null;\n\nvar user = {};\nvar cwd = '/';\n\nvar PATH = $('body').data('path').replace(/\\/$/, '');\nvar TOKEN = $terminal.data('token');\n\nvar months = [\n    'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',\n    'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'\n];\n\nactions.define('close', function () {\n    location.href = PATH + '/files' + cwd;\n});\n\nfunction convertPath(path)\n{\n    path = path.trim();\n    if (path.startsWith('~')) {\n        path = user.home + path.substr(1);\n    } else if (!path.startsWith('/')) {\n        path = cwd + '/' + path;\n    }\n    var names = path.split('/');\n    var stack = [];\n    for (var i = 0; i < names.length; i++) {\n        if (names[i] === '..') {\n            if (stack.length >= 1) {\n                stack.pop();\n            }\n        } else if (names[i] !== '' && names[i] !== '.') {\n            stack.push(names[i]);\n        }\n    }\n    return '/' + stack.join('/');\n}\n\nvar commands = {\n    clear: function (args) {\n        buffer = '';\n        flush();\n        prompt();\n    },\n    cd: function (args) {\n        var nwd = convertPath(args);\n        exec('list-files?path=' + nwd, {}, function (data) {\n            if (data.type === 'directory') {\n                cwd = nwd;\n            } else {\n                writeLine('not a directory');\n            }\n        });\n    },\n    pwd: function (args) {\n        writeLine(cwd);\n        prompt();\n    },\n    ls: function (args) {\n        exec('list-files?path=' + cwd, {}, function (data) {\n            if (typeof data.files !== 'undefined') {\n                data.files.forEach(function (file) {\n                    var line = file.modeString;\n                    line += ' \\t' + file.owner;\n                    line += ' \\t' + file.group;\n                    var date = new Date(file.modified * 1000);\n                    line += ' \\t' + date.getFullYear();\n                    line += ' ' + months[date.getMonth()];\n                    line += ' ' + date.getDate();\n                    line += ' \\t' + file.name;\n                    if (file.type === 'directory') {\n                        line += '/';\n                    }\n                    writeLine(line);\n                });\n            }\n        });\n    },\n    touch: function (args) {\n        exec('make-file', {path: convertPath(args)}, function (data) {\n        });\n    },\n    mkdir: function (args) {\n        exec('make-dir', {path: convertPath(args)}, function (data) {\n        });\n    },\n    rm: function (args) {\n        exec('delete', {path: convertPath(args)}, function (data) {\n        });\n    },\n    cp: function (args) {\n        args = args.split(' ');\n        exec('copy', {path: convertPath(args[0]), destination: convertPath(args[1])}, function (data) {\n        });\n    },\n    mv: function (args) {\n        args = args.split(' ');\n        exec('move', {path: convertPath(args[0]), destination: convertPath(args[1])}, function (data) {\n        });\n    },\n    cat: function (args) {\n        exec('download?path=' + convertPath(args), {}, function (data) {\n            writeLine(data);\n        });\n    },\n    exit: function (args) {\n        location.href = PATH + '/files' + convertPath(args);\n    },\n    open: function (args) {\n        location.href = PATH + '/open' + convertPath(args);\n    },\n    edit: function (args) {\n        location.href = PATH + '/edit' + convertPath(args);\n    },\n    cedit: function (args) {\n        location.href = PATH + '/code-edit' + convertPath(args);\n    }\n};\n\nfunction flush()\n{\n    $terminal.val(buffer);\n    $terminal[0].scrollTop = $terminal[0].scrollHeight;\n//    $terminal.scrollTop($terminal.innerHeight());\n}\n\nfunction write(content)\n{\n    buffer += content;\n    flush();\n}\n\nfunction writeLine(content)\n{\n    write(content + '\\n');\n}\n\nfunction readLine(callback)\n{\n    $terminal.attr('readonly', false).focus();\n    readCallback = callback;\n}\n\nfunction exec(command, data, success)\n{\n    data['request_token'] = TOKEN;\n    $.ajax({\n        url: PATH + '/api/' + command,\n        method: 'post',\n        data: data,\n        success: success,\n        error: function (xhr) {\n            ui.shake($('.frame'));\n            if (xhr.status === 404) {\n                writeLine(xhr.status + ' ' + command + ': command not found');\n            } else if (typeof xhr.responseJSON !== 'undefined') {\n                writeLine(xhr.status + '(' + xhr.responseJSON.code + ') ' + xhr.responseJSON.message);\n            } else {\n                writeLine(xhr.status + ' ' + xhr.statusText + ': ' + xhr.responseText);\n            }\n        },\n        complete: prompt\n    });\n}\n\nfunction prompt()\n{\n    write(user.username + ' ' + cwd + '> ');\n    cmdHistoryPos = -1;\n    readLine(function (line) {\n        var m = line.trim().match(/^([^ ]+)(?: (.*))?/);\n        if (m === null) {\n            writeLine('Invalid command');\n            prompt();\n        } else {\n            var command = m[1];\n            if (commands.hasOwnProperty(command)) {\n                commands[command]((typeof m[2] === 'undefined')? '' : m[2]);\n            } else {\n                try {\n                    var data = (typeof m[2] === 'undefined') ? {} : JSON.parse(m[2]);\n                    exec(command, data, function (data) {\n                        writeLine(JSON.stringify(data, null, '  '));\n                    });\n                } catch (e) {\n                    writeLine(e);\n                    prompt();\n                }\n            }\n        }\n    });\n}\n\n$terminal.attr('readonly', true);\n$terminal.keydown(function (e) {\n    if (e.key === 'Enter' && !e.shiftKey) {\n        if (readCallback !== null) {\n            $terminal.attr('readonly', true).blur();\n            var line = $terminal.val().substr(buffer.length);\n            cmdHistory.push(line);\n            buffer += line + '\\n';\n            flush();\n            var callback = readCallback;\n            readCallback = null;\n            callback(line);\n        }\n        e.preventDefault();\n        e.stopPropagation();\n    } else if (e.key == 'ArrowUp') {\n        if (readCallback !== null) {\n            if (cmdHistory.length > 0) {\n                if (cmdHistoryPos < 0) {\n                    cmdHistoryPos = cmdHistory.length - 1;\n                } else if (cmdHistoryPos > 0) {\n                    cmdHistoryPos--;\n                }\n                $terminal.val(buffer + cmdHistory[cmdHistoryPos]);\n            }\n        }\n        e.preventDefault();\n        e.stopPropagation();\n    } else if (e.key == 'ArrowDown') {\n        if (readCallback !== null) {\n            if (cmdHistory.length > 0 && cmdHistoryPos >= 0) {\n                if (cmdHistoryPos < cmdHistory.length - 1) {\n                    cmdHistoryPos++;\n                    $terminal.val(buffer + cmdHistory[cmdHistoryPos]);\n                } else {\n                    cmdHistoryPos = -1;\n                    $terminal.val(buffer);\n                }\n            }\n        }\n        e.preventDefault();\n        e.stopPropagation();\n    } else if (e.key == 'ArrowLeft' || e.key == 'Backspace') {\n        var start = $terminal[0].selectionStart;\n        var end = $terminal[0].selectionEnd;\n        if (start === end) {\n            if (start <= buffer.length) {\n                e.preventDefault();\n                e.stopPropagation();\n            }\n        }\n    }\n});\n\n$terminal.click(function () {\n    var start = $terminal[0].selectionStart;\n    var end = $terminal[0].selectionEnd;\n    if (start === end) {\n        if (start < buffer.length) {\n            $terminal[0].selectionStart = $terminal.val().length;\n        }\n    }\n});\n\nexec('who-am-i', {}, function (data) {\n    user = data;\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./terminal.js\n// module id = 55\n// module chunks = 5"],"sourceRoot":""}